Mod_exceedDate=matrix(data=NA, nrow = 60, ncol = 21)
days_topped=matrix(data=NA, nrow = 10, ncol = 21)
Mang_overQlim=matrix(data=NA, nrow = 110, ncol = 21)
Mod_overQlim=matrix(data=NA, nrow = 110, ncol = 21)
DaysOver=matrix(data=NA, nrow = 21, ncol = 6)
colnames(DaysOver)<-c("ManOverS", "ModOverS", "ManOverQ", "ModOverQ", "ManVolQ", "ModVolQ")
for (wy in 1:21){
MaxStor<- results[[wy]][,1]
ModStor<- results[[wy]][,3]
ModQ<- results[[wy]][,5]
ManQ<-FC$Qo[FC$WY == yrs[wy]]
ManagedStor<- FC$AF[FC$WY == yrs[wy]]
Mexceed <- which(ManagedStor > MaxStor)
l=length(Mexceed)
if(l>0){
MexceedDate[1:l, wy] <-Mexceed
}
Mod_exceed <- which(ModStor > MaxStor)
ll=length(Mod_exceed)
if(ll>0){
Mod_exceedDate[1:ll, wy]<-Mod_exceed
}
topped <- which(ModStor > maxAF)
lll<-length(topped)
if (lll>0){
days_topped[1:lll, wy]<-topped
}
Mg_Q<- which(ManQ > qlim[1:196,2])
ml<-length( Mg_Q)
if (ml>0){
Mang_overQlim[1:ml, wy]<-Mg_Q
Man_Vol_over_Qlim<-sum(ManQ[Mg_Q]-qlim[Mg_Q,2])
} else{Man_Vol_over_Qlim<-0}
Mod_Q <- which(ModQ >qlim[1:196,2])
mll<-length(Mod_Q)
if (mll>0){
Mod_overQlim[1:mll, wy]<-Mod_Q
Mod_Vol_over_Qlim<-sum(ModQ[Mod_Q]-qlim[Mod_Q,2])
} else{Mod_Vol_over_Qlim<-0}
DaysOver[wy,]<-c(l,ll,ml,mll,Man_Vol_over_Qlim, Mod_Vol_over_Qlim)
}
topped
length(topped)
MexceedDate=matrix(data=NA, nrow = 60, ncol = 21)
Mod_exceedDate=matrix(data=NA, nrow = 60, ncol = 21)
days_topped=matrix(data=NA, nrow = 20, ncol = 21)
Mang_overQlim=matrix(data=NA, nrow = 110, ncol = 21)
Mod_overQlim=matrix(data=NA, nrow = 110, ncol = 21)
DaysOver=matrix(data=NA, nrow = 21, ncol = 6)
colnames(DaysOver)<-c("ManOverS", "ModOverS", "ManOverQ", "ModOverQ", "ManVolQ", "ModVolQ")
for (wy in 1:21){
MaxStor<- results[[wy]][,1]
ModStor<- results[[wy]][,3]
ModQ<- results[[wy]][,5]
ManQ<-FC$Qo[FC$WY == yrs[wy]]
ManagedStor<- FC$AF[FC$WY == yrs[wy]]
Mexceed <- which(ManagedStor > MaxStor)
l=length(Mexceed)
if(l>0){
MexceedDate[1:l, wy] <-Mexceed
}
Mod_exceed <- which(ModStor > MaxStor)
ll=length(Mod_exceed)
if(ll>0){
Mod_exceedDate[1:ll, wy]<-Mod_exceed
}
topped <- which(ModStor > maxAF)
lll<-length(topped)
if (lll>0){
days_topped[1:lll, wy]<-topped
}
Mg_Q<- which(ManQ > qlim[1:196,2])
ml<-length( Mg_Q)
if (ml>0){
Mang_overQlim[1:ml, wy]<-Mg_Q
Man_Vol_over_Qlim<-sum(ManQ[Mg_Q]-qlim[Mg_Q,2])
} else{Man_Vol_over_Qlim<-0}
Mod_Q <- which(ModQ >qlim[1:196,2])
mll<-length(Mod_Q)
if (mll>0){
Mod_overQlim[1:mll, wy]<-Mod_Q
Mod_Vol_over_Qlim<-sum(ModQ[Mod_Q]-qlim[Mod_Q,2])
} else{Mod_Vol_over_Qlim<-0}
DaysOver[wy,]<-c(l,ll,ml,mll,Man_Vol_over_Qlim, Mod_Vol_over_Qlim)
}
View(DaysOver)
View(days_topped)
for (wy in 1:21){
plot(results[[wy]][,1], type='l', ylim=c(300000, 1010200)) #max storage
lines(results[[wy]][,3], col='orange') #modeled storage
lines(FC$AF[FC$WY == yrs[wy]], col='green') #actual storage
#plot(Qmin, type='l', col='blue', ylim=c(0,16000))
plot(results[[wy]][,5], type='l', lty=3, col='orange', ylim=c(0,16000)) #modeled discharge
lines(qlim[,2], type='l', lty=3, col='grey17')
lines(FC$Qo[FC$WY == yrs[wy]], type='l', lty=5, lwd='1', col='skyblue1') #manged outflow
}
seq(4)
zz=seq(4)
rev(zz)
day
day=10
s
day=44
stor[(day-s):day]
w=seq(s)
weightedStor=w*stors
stors=stor[(day-s):day]
weightedStor=w*stors
stors=stor[(day-s+1):day]
weightedStor=w*stors
weightedDStor=(w*stors)/14
weightedDStor=(w*stors)
weightedDStor/14
dsdt= (stor[day] - stor[day-s])/s
dsdt
weightedDStor=(w*stors)/s
plot(weightedDStor)
weightedDStor=sum(w*stors)/s
weightedDStor
view(stors)
View(stors)
plot(stors)
stors=stor[(day-s+1):day]
dstor=matrix(data=NA, nrow = s, ncol = 1)
for(i in 1:(s-1)){
dstor[i]=(stor[i+1]-stor[i])
}
View(dstor)
stors=stor[(day-s):day]
for(i in 1:s){
dstor[i]=(stor[i+1]-stor[i])
}
View(dstor)
weightedDStor=sum(w*dstor)/s
weightedDStor
(stor[day] - stor[day-s])/s
plot(dstor)
plot((w*dstor)/s)
sum((w*dstor)/s)
sum((w/s)*dstor)
w
w/s
w=seq(s)/s
weightedDStor=sum(w*dstor)
weightedDStor
dstor
mean(dstor)
(stor[day] - stor[day-s])/s
w*dstor
w
sum(w)
sum(w*dstor)/sum(w)
View(storF)
forecastS<-function(s,m,day){
if (day > s+1){
w=seq(s)/s
stors=stor[(day-s):day]
dstor=matrix(data=NA, nrow = s, ncol = 1)
for(i in 1:s){
dstor[i]=(stor[i+1]-stor[i])
}
weightedDStor=sum(w*dstor)/sum(w)
#dsdt= (stor[day] - stor[day-s])/s #calculate daily change in storage over past s days --> change this to 1) take average of dS over s days, 2) create weighted average
storF[day] <<- (weightedDStor*m)+stor[day] #forecasted flow for today is the change in storage* m days added to todays storage
} else {storF[day]<<- stor[day]}
}
m=14
s=14
results<- outflowStor(s,m)
#plot the initial results
for (wy in 1:21){
plot(results[[wy]][,1], type='l', ylim=c(300000, 1010200)) #max storage
lines(results[[wy]][,3], col='orange') #modeled storage
lines(FC$AF[FC$WY == yrs[wy]], col='green') #actual storage
#plot(Qmin, type='l', col='blue', ylim=c(0,16000))
#plot(results[[wy]][,5], type='l', lty=3, col='orange', ylim=c(0,16000)) #modeled discharge
#lines(qlim[,2], type='l', lty=3, col='grey17')
#lines(FC$Qo[FC$WY == yrs[wy]], type='l', lty=5, lwd='1', col='skyblue1') #manged outflow
}
MexceedDate=matrix(data=NA, nrow = 60, ncol = 21)
Mod_exceedDate=matrix(data=NA, nrow = 60, ncol = 21)
days_topped=matrix(data=NA, nrow = 20, ncol = 21)
Mang_overQlim=matrix(data=NA, nrow = 110, ncol = 21)
Mod_overQlim=matrix(data=NA, nrow = 110, ncol = 21)
DaysOver=matrix(data=NA, nrow = 21, ncol = 6)
colnames(DaysOver)<-c("ManOverS", "ModOverS", "ManOverQ", "ModOverQ", "ManVolQ", "ModVolQ")
for (wy in 1:21){
MaxStor<- results[[wy]][,1]
ModStor<- results[[wy]][,3]
ModQ<- results[[wy]][,5]
ManQ<-FC$Qo[FC$WY == yrs[wy]]
ManagedStor<- FC$AF[FC$WY == yrs[wy]]
Mexceed <- which(ManagedStor > MaxStor)
l=length(Mexceed)
if(l>0){
MexceedDate[1:l, wy] <-Mexceed
}
Mod_exceed <- which(ModStor > MaxStor)
ll=length(Mod_exceed)
if(ll>0){
Mod_exceedDate[1:ll, wy]<-Mod_exceed
}
topped <- which(ModStor > maxAF)
lll<-length(topped)
if (lll>0){
days_topped[1:lll, wy]<-topped
}
Mg_Q<- which(ManQ > qlim[1:196,2])
ml<-length( Mg_Q)
if (ml>0){
Mang_overQlim[1:ml, wy]<-Mg_Q
Man_Vol_over_Qlim<-sum(ManQ[Mg_Q]-qlim[Mg_Q,2])
} else{Man_Vol_over_Qlim<-0}
Mod_Q <- which(ModQ >qlim[1:196,2])
mll<-length(Mod_Q)
if (mll>0){
Mod_overQlim[1:mll, wy]<-Mod_Q
Mod_Vol_over_Qlim<-sum(ModQ[Mod_Q]-qlim[Mod_Q,2])
} else{Mod_Vol_over_Qlim<-0}
DaysOver[wy,]<-c(l,ll,ml,mll,Man_Vol_over_Qlim, Mod_Vol_over_Qlim)
}
length(topped)
MexceedDate=matrix(data=NA, nrow = 60, ncol = 21)
Mod_exceedDate=matrix(data=NA, nrow = 60, ncol = 21)
days_topped=matrix(data=NA, nrow = 26, ncol = 21)
Mang_overQlim=matrix(data=NA, nrow = 110, ncol = 21)
Mod_overQlim=matrix(data=NA, nrow = 110, ncol = 21)
DaysOver=matrix(data=NA, nrow = 21, ncol = 6)
colnames(DaysOver)<-c("ManOverS", "ModOverS", "ManOverQ", "ModOverQ", "ManVolQ", "ModVolQ")
for (wy in 1:21){
MaxStor<- results[[wy]][,1]
ModStor<- results[[wy]][,3]
ModQ<- results[[wy]][,5]
ManQ<-FC$Qo[FC$WY == yrs[wy]]
ManagedStor<- FC$AF[FC$WY == yrs[wy]]
Mexceed <- which(ManagedStor > MaxStor)
l=length(Mexceed)
if(l>0){
MexceedDate[1:l, wy] <-Mexceed
}
Mod_exceed <- which(ModStor > MaxStor)
ll=length(Mod_exceed)
if(ll>0){
Mod_exceedDate[1:ll, wy]<-Mod_exceed
}
topped <- which(ModStor > maxAF)
lll<-length(topped)
if (lll>0){
days_topped[1:lll, wy]<-topped
}
Mg_Q<- which(ManQ > qlim[1:196,2])
ml<-length( Mg_Q)
if (ml>0){
Mang_overQlim[1:ml, wy]<-Mg_Q
Man_Vol_over_Qlim<-sum(ManQ[Mg_Q]-qlim[Mg_Q,2])
} else{Man_Vol_over_Qlim<-0}
Mod_Q <- which(ModQ >qlim[1:196,2])
mll<-length(Mod_Q)
if (mll>0){
Mod_overQlim[1:mll, wy]<-Mod_Q
Mod_Vol_over_Qlim<-sum(ModQ[Mod_Q]-qlim[Mod_Q,2])
} else{Mod_Vol_over_Qlim<-0}
DaysOver[wy,]<-c(l,ll,ml,mll,Man_Vol_over_Qlim, Mod_Vol_over_Qlim)
}
forecastS<-function(s,m,day){
if (day > s+1){
w=seq(s)/s
stors=stor[(day-s):day]
dstor=matrix(data=NA, nrow = s, ncol = 1)
for(i in 1:s){
dstor[i]=(stor[i+1]-stor[i])
}
#dsdt=sum(w*dstor)/sum(w) #weighted change in storage
dsdt=mean(dstor)
#dsdt= (stor[day] - stor[day-s])/s #calculate daily change in storage over past s days --> change this to 1) take average of dS over s days, 2) create weighted average
storF[day] <<- (dsdt*m)+stor[day] #forecasted flow for today is the change in storage* m days added to todays storage
} else {storF[day]<<- stor[day]}
}
m=14
s=14
results<- outflowStor(s,m)
MexceedDate=matrix(data=NA, nrow = 60, ncol = 21)
Mod_exceedDate=matrix(data=NA, nrow = 60, ncol = 21)
days_topped=matrix(data=NA, nrow = 26, ncol = 21)
Mang_overQlim=matrix(data=NA, nrow = 110, ncol = 21)
Mod_overQlim=matrix(data=NA, nrow = 110, ncol = 21)
DaysOver=matrix(data=NA, nrow = 21, ncol = 6)
colnames(DaysOver)<-c("ManOverS", "ModOverS", "ManOverQ", "ModOverQ", "ManVolQ", "ModVolQ")
for (wy in 1:21){
MaxStor<- results[[wy]][,1]
ModStor<- results[[wy]][,3]
ModQ<- results[[wy]][,5]
ManQ<-FC$Qo[FC$WY == yrs[wy]]
ManagedStor<- FC$AF[FC$WY == yrs[wy]]
Mexceed <- which(ManagedStor > MaxStor)
l=length(Mexceed)
if(l>0){
MexceedDate[1:l, wy] <-Mexceed
}
Mod_exceed <- which(ModStor > MaxStor)
ll=length(Mod_exceed)
if(ll>0){
Mod_exceedDate[1:ll, wy]<-Mod_exceed
}
topped <- which(ModStor > maxAF)
lll<-length(topped)
if (lll>0){
days_topped[1:lll, wy]<-topped
}
Mg_Q<- which(ManQ > qlim[1:196,2])
ml<-length( Mg_Q)
if (ml>0){
Mang_overQlim[1:ml, wy]<-Mg_Q
Man_Vol_over_Qlim<-sum(ManQ[Mg_Q]-qlim[Mg_Q,2])
} else{Man_Vol_over_Qlim<-0}
Mod_Q <- which(ModQ >qlim[1:196,2])
mll<-length(Mod_Q)
if (mll>0){
Mod_overQlim[1:mll, wy]<-Mod_Q
Mod_Vol_over_Qlim<-sum(ModQ[Mod_Q]-qlim[Mod_Q,2])
} else{Mod_Vol_over_Qlim<-0}
DaysOver[wy,]<-c(l,ll,ml,mll,Man_Vol_over_Qlim, Mod_Vol_over_Qlim)
}
MexceedDate=matrix(data=NA, nrow = 60, ncol = 21)
Mod_exceedDate=matrix(data=NA, nrow = 60, ncol = 21)
days_topped=matrix(data=NA, nrow = 30, ncol = 21)
Mang_overQlim=matrix(data=NA, nrow = 110, ncol = 21)
Mod_overQlim=matrix(data=NA, nrow = 110, ncol = 21)
DaysOver=matrix(data=NA, nrow = 21, ncol = 6)
colnames(DaysOver)<-c("ManOverS", "ModOverS", "ManOverQ", "ModOverQ", "ManVolQ", "ModVolQ")
for (wy in 1:21){
MaxStor<- results[[wy]][,1]
ModStor<- results[[wy]][,3]
ModQ<- results[[wy]][,5]
ManQ<-FC$Qo[FC$WY == yrs[wy]]
ManagedStor<- FC$AF[FC$WY == yrs[wy]]
Mexceed <- which(ManagedStor > MaxStor)
l=length(Mexceed)
if(l>0){
MexceedDate[1:l, wy] <-Mexceed
}
Mod_exceed <- which(ModStor > MaxStor)
ll=length(Mod_exceed)
if(ll>0){
Mod_exceedDate[1:ll, wy]<-Mod_exceed
}
topped <- which(ModStor > maxAF)
lll<-length(topped)
if (lll>0){
days_topped[1:lll, wy]<-topped
}
Mg_Q<- which(ManQ > qlim[1:196,2])
ml<-length( Mg_Q)
if (ml>0){
Mang_overQlim[1:ml, wy]<-Mg_Q
Man_Vol_over_Qlim<-sum(ManQ[Mg_Q]-qlim[Mg_Q,2])
} else{Man_Vol_over_Qlim<-0}
Mod_Q <- which(ModQ >qlim[1:196,2])
mll<-length(Mod_Q)
if (mll>0){
Mod_overQlim[1:mll, wy]<-Mod_Q
Mod_Vol_over_Qlim<-sum(ModQ[Mod_Q]-qlim[Mod_Q,2])
} else{Mod_Vol_over_Qlim<-0}
DaysOver[wy,]<-c(l,ll,ml,mll,Man_Vol_over_Qlim, Mod_Vol_over_Qlim)
}
m=14
s=5
results<- outflowStor(s,m)
MexceedDate=matrix(data=NA, nrow = 60, ncol = 21)
Mod_exceedDate=matrix(data=NA, nrow = 60, ncol = 21)
days_topped=matrix(data=NA, nrow = 30, ncol = 21)
Mang_overQlim=matrix(data=NA, nrow = 110, ncol = 21)
Mod_overQlim=matrix(data=NA, nrow = 110, ncol = 21)
DaysOver=matrix(data=NA, nrow = 21, ncol = 6)
colnames(DaysOver)<-c("ManOverS", "ModOverS", "ManOverQ", "ModOverQ", "ManVolQ", "ModVolQ")
for (wy in 1:21){
MaxStor<- results[[wy]][,1]
ModStor<- results[[wy]][,3]
ModQ<- results[[wy]][,5]
ManQ<-FC$Qo[FC$WY == yrs[wy]]
ManagedStor<- FC$AF[FC$WY == yrs[wy]]
Mexceed <- which(ManagedStor > MaxStor)
l=length(Mexceed)
if(l>0){
MexceedDate[1:l, wy] <-Mexceed
}
Mod_exceed <- which(ModStor > MaxStor)
ll=length(Mod_exceed)
if(ll>0){
Mod_exceedDate[1:ll, wy]<-Mod_exceed
}
topped <- which(ModStor > maxAF)
lll<-length(topped)
if (lll>0){
days_topped[1:lll, wy]<-topped
}
Mg_Q<- which(ManQ > qlim[1:196,2])
ml<-length( Mg_Q)
if (ml>0){
Mang_overQlim[1:ml, wy]<-Mg_Q
Man_Vol_over_Qlim<-sum(ManQ[Mg_Q]-qlim[Mg_Q,2])
} else{Man_Vol_over_Qlim<-0}
Mod_Q <- which(ModQ >qlim[1:196,2])
mll<-length(Mod_Q)
if (mll>0){
Mod_overQlim[1:mll, wy]<-Mod_Q
Mod_Vol_over_Qlim<-sum(ModQ[Mod_Q]-qlim[Mod_Q,2])
} else{Mod_Vol_over_Qlim<-0}
DaysOver[wy,]<-c(l,ll,ml,mll,Man_Vol_over_Qlim, Mod_Vol_over_Qlim)
}
MexceedDate=matrix(data=NA, nrow = 60, ncol = 21)
Mod_exceedDate=matrix(data=NA, nrow = 60, ncol = 21)
days_topped=matrix(data=NA, nrow = 30, ncol = 21)
Mang_overQlim=matrix(data=NA, nrow = 110, ncol = 21)
Mod_overQlim=matrix(data=NA, nrow = 110, ncol = 21)
DaysOver=matrix(data=NA, nrow = 21, ncol = 6)
colnames(DaysOver)<-c("ManOverS", "ModOverS", "ManOverQ", "ModOverQ", "ManVolQ", "ModVolQ")
for (wy in 1:21){
MaxStor<- results[[wy]][,1]
ModStor<- results[[wy]][,3]
ModQ<- results[[wy]][,5]
ManQ<-FC$Qo[FC$WY == yrs[wy]]
ManagedStor<- FC$AF[FC$WY == yrs[wy]]
Mexceed <- which(ManagedStor > MaxStor)
l=length(Mexceed)
if(l>0){
MexceedDate[1:l, wy] <-Mexceed
}
Mod_exceed <- which(ModStor > MaxStor)
ll=length(Mod_exceed)
if(ll>0){
Mod_exceedDate[1:ll, wy]<-Mod_exceed
}
topped <- which(ModStor > maxAF)
lll<-length(topped)
if (lll>0){
days_topped[1:lll, wy]<-topped
}
Mg_Q<- which(ManQ > qlim[1:196,2])
ml<-length( Mg_Q)
if (ml>0){
Mang_overQlim[1:ml, wy]<-Mg_Q
Man_Vol_over_Qlim<-sum(ManQ[Mg_Q]-qlim[Mg_Q,2])
} else{Man_Vol_over_Qlim<-0}
Mod_Q <- which(ModQ >qlim[1:196,2])
mll<-length(Mod_Q)
if (mll>0){
Mod_overQlim[1:mll, wy]<-Mod_Q
Mod_Vol_over_Qlim<-sum(ModQ[Mod_Q]-qlim[Mod_Q,2])
} else{Mod_Vol_over_Qlim<-0}
DaysOver[wy,]<-c(l,ll,ml,mll,Man_Vol_over_Qlim, Mod_Vol_over_Qlim)
}
forecastS<-function(s,m,day){
if (day > s+1){
#w=seq(s)/s
#stors=stor[(day-s):day]
#dstor=matrix(data=NA, nrow = s, ncol = 1)
#for(i in 1:s){
#  dstor[i]=(stor[i+1]-stor[i])
#}
#dsdt=sum(w*dstor)/sum(w) #weighted change in storage
#dsdt=mean(dstor)
dsdt= (stor[day] - stor[day-s])/s #calculate daily change in storage over past s days
storF[day] <<- (dsdt*m)+stor[day] #forecasted flow for today is the change in storage* m days added to todays storage
} else {storF[day]<<- stor[day]}
}
m=14
s=14
results<- outflowStor(s,m)
MexceedDate=matrix(data=NA, nrow = 60, ncol = 21)
Mod_exceedDate=matrix(data=NA, nrow = 60, ncol = 21)
days_topped=matrix(data=NA, nrow = 30, ncol = 21)
Mang_overQlim=matrix(data=NA, nrow = 110, ncol = 21)
Mod_overQlim=matrix(data=NA, nrow = 110, ncol = 21)
DaysOver=matrix(data=NA, nrow = 21, ncol = 6)
colnames(DaysOver)<-c("ManOverS", "ModOverS", "ManOverQ", "ModOverQ", "ManVolQ", "ModVolQ")
for (wy in 1:21){
MaxStor<- results[[wy]][,1]
ModStor<- results[[wy]][,3]
ModQ<- results[[wy]][,5]
ManQ<-FC$Qo[FC$WY == yrs[wy]]
ManagedStor<- FC$AF[FC$WY == yrs[wy]]
Mexceed <- which(ManagedStor > MaxStor)
l=length(Mexceed)
if(l>0){
MexceedDate[1:l, wy] <-Mexceed
}
Mod_exceed <- which(ModStor > MaxStor)
ll=length(Mod_exceed)
if(ll>0){
Mod_exceedDate[1:ll, wy]<-Mod_exceed
}
topped <- which(ModStor > maxAF)
lll<-length(topped)
if (lll>0){
days_topped[1:lll, wy]<-topped
}
Mg_Q<- which(ManQ > qlim[1:196,2])
ml<-length( Mg_Q)
if (ml>0){
Mang_overQlim[1:ml, wy]<-Mg_Q
Man_Vol_over_Qlim<-sum(ManQ[Mg_Q]-qlim[Mg_Q,2])
} else{Man_Vol_over_Qlim<-0}
Mod_Q <- which(ModQ >qlim[1:196,2])
mll<-length(Mod_Q)
if (mll>0){
Mod_overQlim[1:mll, wy]<-Mod_Q
Mod_Vol_over_Qlim<-sum(ModQ[Mod_Q]-qlim[Mod_Q,2])
} else{Mod_Vol_over_Qlim<-0}
DaysOver[wy,]<-c(l,ll,ml,mll,Man_Vol_over_Qlim, Mod_Vol_over_Qlim)
}
View(DaysOver)
